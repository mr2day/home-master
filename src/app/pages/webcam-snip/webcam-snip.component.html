<div class="webcam-container">
  <div class="webcam-wrapper">
    <video
      #videoElement
      class="webcam-video"
      autoplay
      playsinline
    ></video>

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }
  </div>
  <div class="left-controls">
    <div class="focus-control">
      <label for="shutter-speed-input">Shutter</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustShutterSpeedBy(1)">+</button>
        <input
          id="shutter-speed-input"
          type="text"
          [value]="shutterLabel()"
          readonly
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustShutterSpeedBy(-1)">-</button>
      </div>
    </div>
    <div class="focus-control">
      <label for="focus-input">Focus</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustFocusBy(10)">+</button>
        <input
          id="focus-input"
          type="text"
          [value]="focusValue()"
          (change)="onFocusInputChange($event)"
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustFocusBy(-10)">-</button>
      </div>
    </div>
    <div class="focus-control">
      <label for="resolution-input">Resolution</label>
      <div class="focus-input-group">
        <select
          id="resolution-input"
          [value]="resolutionValue()"
          (change)="onResolutionInputChange($event)"
          class="resolution-select"
        >
          @for (res of availableResolutions(); track $index) {
            <option
              [value]="res.width + 'x' + res.height"
              [selected]="(res.width + 'x' + res.height) === resolutionValue()"
            >
              {{ res.width + 'x' + res.height }}
            </option>
          }
        </select>
      </div>
    </div>
  </div>
  @if (dccService.isConnected()) {
    <div class="train-controls-bottom">
      <div class="train-control-item">
        <label for="loco-address">Loco</label>
        <input
          id="loco-address"
          type="number"
          min="1"
          max="10239"
          [value]="locoAddress()"
          (change)="onLocoAddressChange($event)"
          class="train-input"
        />
      </div>

      <div class="train-control-item">
        <label>Power: {{ trackPower() ? 'ON' : 'OFF' }}</label>
        <div class="power-buttons">
          <button class="focus-btn" (click)="toggleTrackPower()">Toggle</button>
        </div>
      </div>

      <div class="train-control-item">
        <label>Speed: {{ locoSpeed() }}</label>
        <div class="speed-buttons">
          <button class="focus-btn" (click)="adjustSpeedBy(1)">+</button>
          <button class="focus-btn" (click)="adjustSpeedBy(-1)">-</button>
        </div>
      </div>

      <div class="train-control-item">
        <label>Dir: {{ locoDirection() ? 'Forward' : 'Reverse' }}</label>
        <div class="direction-buttons">
          <button class="focus-btn" (click)="setDirection(true)">Fwd</button>
          <button class="focus-btn" (click)="setDirection(false)">Rev</button>
        </div>
      </div>

      <div class="train-control-item">
        <label>Functions</label>
        <div class="function-buttons">
          @for (fn of [0, 1, 2, 3, 4]; track fn) {
            <button
              class="function-btn"
              [class.active]="isFunctionActive(fn)"
              (click)="toggleFunction(fn)"
            >
              F{{ fn }}
            </button>
          }
        </div>
      </div>

      <div class="train-control-item">
        <label for="debug-command">Debug</label>
        <div class="debug-controls">
          <input
            id="debug-command"
            type="text"
            [value]="debugCommand()"
            (input)="onDebugCommandChange($event)"
            placeholder="<D HAL SHOW>"
            class="train-input"
          />
          <button class="focus-btn" (click)="sendDebugCommand()">Send</button>
        </div>
      </div>
    </div>
  }
  <div class="button-group">
    <div class="controls-column">
      <div class="action-controls">
        <div class="record-info">
          @if (isRecording()) {
            <span class="recording-indicator"><span class="recording-dot"></span> Recording</span>
            <span class="recording-time">{{ recordingTime() }}</span>
          }
          @if (dccService.isConnected()) {
            <span class="dcc-connected">DCC Connected</span>
          }
        </div>
        <div class="buttons">
          <h-button
            [label]="isRecording() ? 'Stop' : 'Record'"
            [size]="'sm'"
            [ratio]="'square'"
            [action]="toggleRecordingAction"
          ></h-button>
          <h-button
            [label]="'Snip'"
            [size]="'md'"
            [ratio]="'square'"
            [action]="snipAction"
          ></h-button>
          <h-button
            [label]="dccService.isConnected() ? 'Disconnect' : 'Connect DCC'"
            [size]="'sm'"
            [ratio]="'square'"
            [action]="toggleDccConnectionAction"
          ></h-button>
          @if (dccService.isConnected()) {
            <h-button
              [label]="'Test'"
              [size]="'sm'"
              [ratio]="'square'"
              [action]="testDccAction"
            ></h-button>
          }
        </div>
      </div>
    </div>
  </div>
</div>
