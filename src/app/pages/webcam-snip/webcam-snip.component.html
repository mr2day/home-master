<div class="webcam-container">
  <div class="webcam-wrapper">
    <video
      #videoElement
      class="webcam-video"
      autoplay
      playsinline
    ></video>

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }
  </div>
  <div class="left-controls">
    <div class="focus-control">
      <label for="shutter-speed-input">Shutter</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustShutterSpeedBy(1)">+</button>
        <input
          id="shutter-speed-input"
          type="text"
          [value]="shutterLabel()"
          readonly
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustShutterSpeedBy(-1)">-</button>
      </div>
    </div>
    <div class="focus-control">
      <label for="focus-input">Focus</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustFocusBy(10)">+</button>
        <input
          id="focus-input"
          type="text"
          [value]="focusValue()"
          (change)="onFocusInputChange($event)"
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustFocusBy(-10)">-</button>
      </div>
    </div>
    <div class="focus-control">
      <label for="resolution-input">Resolution</label>
      <div class="focus-input-group">
        <select
          id="resolution-input"
          [value]="resolutionValue()"
          (change)="onResolutionInputChange($event)"
          class="resolution-select"
        >
          @for (res of availableResolutions(); track $index) {
            <option
              [value]="res.width + 'x' + res.height"
              [selected]="(res.width + 'x' + res.height) === resolutionValue()"
            >
              {{ res.width + 'x' + res.height }}
            </option>
          }
        </select>
      </div>
    </div>
  </div>
  <div class="button-group">
    <div class="controls-column">
      @if (dccService.isConnected()) {
        <div class="train-controls">
          <div class="train-control-section">
            <label for="loco-address">Loco Address</label>
            <input
              id="loco-address"
              type="number"
              min="1"
              max="10239"
              [value]="locoAddress()"
              (change)="onLocoAddressChange($event)"
              class="train-input"
            />
          </div>

          <div class="train-control-section">
            <label>Track Power</label>
            <h-button
              [label]="trackPower() ? 'Power OFF' : 'Power ON'"
              [size]="'sm'"
              [ratio]="'square'"
              [action]="toggleTrackPowerAction"
            ></h-button>
          </div>

          <div class="train-control-section">
            <label for="speed-slider">Speed: {{ locoSpeed() }}</label>
            <input
              id="speed-slider"
              type="range"
              min="0"
              max="126"
              [value]="locoSpeed()"
              (input)="onSpeedChange($event)"
              class="speed-slider"
            />
          </div>

          <div class="train-control-section">
            <label>Direction</label>
            <h-button
              [label]="locoDirection() ? 'Forward' : 'Reverse'"
              [size]="'sm'"
              [ratio]="'square'"
              [action]="toggleDirection.bind(this)"
            ></h-button>
          </div>

          <div class="train-control-section">
            <label>Functions</label>
            <div class="function-buttons">
              @for (fn of [0, 1, 2, 3, 4]; track fn) {
                <button
                  class="function-btn"
                  [class.active]="isFunctionActive(fn)"
                  (click)="toggleFunction(fn)"
                >
                  F{{ fn }}
                </button>
              }
            </div>
          </div>
        </div>
      }
      <div class="action-controls">
        <div class="record-info">
          @if (isRecording()) {
            <span class="recording-indicator"><span class="recording-dot"></span> Recording</span>
            <span class="recording-time">{{ recordingTime() }}</span>
          }
          @if (dccService.isConnected()) {
            <span class="dcc-connected">DCC Connected</span>
          }
        </div>
        <div class="buttons">
          <h-button
            [label]="isRecording() ? 'Stop' : 'Record'"
            [size]="'sm'"
            [ratio]="'square'"
            [action]="toggleRecordingAction"
          ></h-button>
          <h-button
            [label]="'Snip'"
            [size]="'md'"
            [ratio]="'square'"
            [action]="snipAction"
          ></h-button>
          <h-button
            [label]="dccService.isConnected() ? 'Disconnect' : 'Connect DCC'"
            [size]="'sm'"
            [ratio]="'square'"
            [action]="toggleDccConnectionAction"
          ></h-button>
          @if (dccService.isConnected()) {
            <h-button
              [label]="'Test'"
              [size]="'sm'"
              [ratio]="'square'"
              [action]="testDccAction"
            ></h-button>
          }
        </div>
      </div>
    </div>
  </div>
</div>
