<div class="webcam-container">
  <div class="webcam-wrapper">
    <video
      #videoElement
      class="webcam-video"
      autoplay
      playsinline
    ></video>

    @if (errorMessage) {
      <div class="error-message">
        {{ errorMessage }}
      </div>
    }
  </div>
  <div class="left-controls">
    <div class="focus-control">
      <label for="focus-input">Focus</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustFocusBy(1)">+</button>
        <input
          id="focus-input"
          type="text"
          [value]="focusValue()"
          (change)="onFocusInputChange($event)"
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustFocusBy(-1)">-</button>
      </div>
    </div>
    <div class="focus-control">
      <label for="brightness-input">Brightness</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustBrightnessBy(1)">+</button>
        <input
          id="brightness-input"
          type="text"
          [value]="brightnessValue()"
          (change)="onBrightnessInputChange($event)"
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustBrightnessBy(-1)">-</button>
      </div>
    </div>
    <div class="focus-control">
      <label for="exposure-compensation-input">Exposure</label>
      <div class="focus-input-group">
        <button class="focus-btn" (click)="adjustExposureCompensationBy(1)">+</button>
        <input
          id="exposure-compensation-input"
          type="text"
          [value]="exposureCompensationValue()"
          (change)="onExposureCompensationInputChange($event)"
          class="focus-input"
        />
        <button class="focus-btn" (click)="adjustExposureCompensationBy(-1)">-</button>
      </div>
    </div>
  </div>
  <div class="button-group">
    <div class="controls-column">
      <div class="focus-control">
        <label for="resolution-input">Resolution</label>
        <div class="focus-input-group">
          <select
            id="resolution-input"
            [value]="resolutionValue()"
            (change)="onResolutionInputChange($event)"
            class="resolution-select"
          >
            @for (res of availableResolutions(); track $index) {
              <option 
                [value]="res.width + 'x' + res.height"
                [selected]="(res.width + 'x' + res.height) === resolutionValue()"
              >
                {{ res.width + 'x' + res.height }}
              </option>
            }
          </select>
        </div>
      </div>
    </div>
    <div class="controls-column">
      <div class="focus-control">
        <label for="shutter-speed-input">Shutter</label>
        <div class="focus-input-group">
          <button class="focus-btn" (click)="adjustShutterSpeedBy(1)">+</button>
          <input
            id="shutter-speed-input"
            type="text"
            [value]="shutterLabel()"
            readonly
            class="focus-input"
          />
          <button class="focus-btn" (click)="adjustShutterSpeedBy(-1)">-</button>
        </div>
      </div>
      <div class="focus-control">
        <label for="contrast-input">Contrast</label>
        <div class="focus-input-group">
          <button class="focus-btn" (click)="adjustContrastBy(1)">+</button>
          <input
            id="contrast-input"
            type="text"
            [value]="contrastValue()"
            (change)="onContrastInputChange($event)"
            class="focus-input"
          />
          <button class="focus-btn" (click)="adjustContrastBy(-1)">-</button>
        </div>
      </div>
      <div class="color-knob" #colorKnob
           (pointerdown)="onColorKnobPointerDown($event)"
           (pointermove)="onColorKnobPointerMove($event)"
           (pointerup)="onColorKnobPointerUp($event)"
           (pointercancel)="onColorKnobPointerUp($event)">
        <div class="color-knob__dial">
          <div class="color-knob__indicator" [style.transform]="'rotate(' + colorKnobAngle() + 'deg)'"></div>
          <div class="color-knob__value">{{ colorTemperatureValue() }}</div>
        </div>
      </div>
      <div class="action-controls">
        <div class="record-info">
          @if (isRecording()) {
            <span class="recording-indicator"><span class="recording-dot"></span> Recording</span>
            <span class="recording-time">{{ recordingTime() }}</span>
          }
        </div>
        <div class="buttons">
          <h-button
            [label]="isRecording() ? 'Stop' : 'Record'"
            [size]="'sm'"
            [ratio]="'square'"
            [action]="toggleRecordingAction"
          ></h-button>
          <h-button
            [label]="'Snip'"
            [size]="'md'"
            [ratio]="'square'"
            [action]="snipAction"
          ></h-button>
        </div>
      </div>
    </div>
  </div>
</div>
